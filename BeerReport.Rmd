---
title: "Analysis of Beers acros the USA"
author: "David Churchman"
date: "June 26, 2017"
output: html_document: keep.md=TRUE
---

#Introduction

In recent decades, the craft beer market in the united states has exploded into an incredibly diverse landscape, with hundreds of different breweries all across the country brewing thousands of types of craft beers. As breweries have proliferated, states have developed regional tastes and breweries have reacted by specializing.  I have performed an analysis of 2410 US craft beers brewed in 558 breweries across all 50 states and the District of Columbia.

I have gathered a data set containing 2410 US craft beers brewed in 558 breweries, with information about the ABV and IBU of each beer.
```{r}
#Read in the data
beers <- read.csv('beers.csv')
head(beers)
str(beers)
```

Additionally, I have a data set of these 558 breweries listing them by state.
```{r}
breweries <-read.csv('breweries.csv')
head(breweries)
str(breweries)
```
You can see in the following table the number of craft breweries in each state, with low-population states like the Dakotas and West Virginia only containing one brewery all the way up to Colorado with 47 breweries.  It appears the Pacific Northwest and the Midwest tend to have the most breweries per state, with notable exceptions like Texas and Massachusetts.
```{r}
# A table displaying the number of breweries in each state.
table(breweries$State)
```

In order to get more information about the individual beers brewed in each state, I must merge the data sets, cross-referencing them using the common element of brewery.
```{r}
#Merge the 2 raw data files and do some basic cleaning
names(breweries)[names(breweries)=="Brew_ID"]<-"Brewery_id"
beermerge<-merge(beers, breweries, by = "Brewery_id")
names(beermerge)[names(beermerge)=="Name.x"] <- "BeerName"
names(beermerge)[names(beermerge)=="Name.y"] <- "BreweryName"
beermerge <- beermerge[order(beermerge$State),]
beermerge$State <- trimws(beermerge$State)
```

Now, I have a data set that has information about individual beers brewed in each state.  As an example of the data available, these are the first six beers in the data set:
```{r}
head(beermerge)
```
And the last six beers:
```{r}
tail(beermerge)
```
In the above rows, you may have noticed that the data set does not have complete information in every element.  "NA" represents information that was not recorded in the data set.  Below is a table of the number of "NAs" in each variable.
```{r}
#Number of NAs in each variable
colSums(is.na(beermerge))
```
Almost half of the beers have missing information about their IBU, and a few dozen have missing information regarding ABV, however there is still a large number of beers with information for both.

#Analysis

IBU is a measure of bitterness for beers.  The way hops are prepared and brewed into the beer can have a large impact on the flavor, with some beers like India Pale Ales with a very strong bitterness, and hence a IBU, and some beers like Blondes with a very low bitterness.  Breweries in different states have developed different tastes for the bitterness of their beer.  Below is the median IBU by state.
```{r}
#Median IBU by state
stateIBU<-aggregate(IBU~State, beermerge,median, na.action=na.omit)
stateIBU
```

This is a bar graph of the above table, which makes it easier to see that Maine has the highest median beer IBU.  
```{r}
#Bar graph of IBU
library("ggplot2")
ggplot(data=stateIBU, aes(x=State, y=IBU, fill=IBU))+scale_fill_distiller(palette="Reds")+
  geom_bar(stat="identity")+theme(text = element_text(size=10),
                                  axis.text.x = element_text(angle=90, hjust=1,vjust=.5))
```

Similarly, the level of alcohol content, measured by ABV varies from state to state.  Below is a table of the median alcohol content by state.
```{r}
stateABV<-aggregate(ABV~State, beermerge, median, na.action = na.omit)
stateABV
```

The below bar chart also shows the median ABV by state.  Utah is a low outlier, which may have something to do with the influence of the Mormon church in Utah and their prohibitions against alcohol.  Kentucky and the District of Columbia have the highest median ABV, followed closely by Maine, New Mexico and West Virginia.   
```{r}
#BarPlot of ABV by State
ggplot(data=stateABV, aes(x=State, y=ABV, fill=ABV)) +
  geom_bar(stat="identity")+theme(text = element_text(size=10),
                                  axis.text.x = element_text(angle=90,   hjust=1,vjust=.5))
```

The fact that Maine showed up high in both median IBU and ABV suggests that there may be some relationship between IBU and ABV. The below plot shows that there is indeed a positive linear relationship between the two, where the higher the bitterness of a beer, the higher its alcohol content.  There also appears to be a maximum threshold ABV of about 0.10 that most beers do not cross, with two outliers. This might be a limitation of the brewing process, or it might be that an ABV greater than 0.10 is too alcoholic and and has an unpalatable flavor. IBU also seems to be clustered, with a significant drop-off after an IBU of 50.
```{r}
#ABV vs. IBU
ggplot(data=beermerge,aes(IBU,ABV))+geom_point(color="blue")+geom_smooth(method=lm,color="red")
cor(IBU, ABV, use = "complete.obs",method=("pearson"))
```

#Conclusion

Brewery data from all fifty states and the District of Columbia show a large variety of beers from many breweries. Breweries are most concentrated in the Pacific Northwest, though all states have at least one brewery in this data set. There are a variety of regional tastes in alcohol content and bitterness around the country, but in general they fall within similar ranges. There does appear to be a correlation between more bitter beers and higher alcohol content, though, again, most beers fall within a fairly tight cluster of values for both.  
